# 硬链接劫持器插件

## 功能说明

这是一个用于劫持 MoviePilot 硬链接方法的插件，专门解决 Windows 通过 NFS 方式共享给 Linux 磁盘后，硬链接刮削时出现乱码的问题。

## 主要特性

1. **方法劫持**: 直接劫持 `LocalStorage.link` 方法，完全替换原始硬链接逻辑
2. **自定义硬链接**: 实现了自定义的硬链接逻辑，解决乱码问题
3. **智能处理**: 自动检测目标文件是否存在，存在则先删除再创建硬链接
4. **状态监控**: 提供插件状态查询和拦截次数统计
5. **安全恢复**: 插件禁用时自动恢复原始方法

## 技术原理

插件通过以下方式工作：
- 保存原始的 `LocalStorage.link` 方法
- 将其替换为自定义的硬链接方法
- 在自定义方法中实现修复乱码的逻辑
- 插件禁用时恢复原始方法

## 使用方法

1. 将插件文件放置在 `plugins.v2/hardlinkjacker/` 目录下
2. 重启 MoviePilot 或重载插件
3. 在插件管理页面启用"硬链接劫持器"插件
4. 执行任何会触发硬链接的操作（如整理文件时选择硬链接模式）
5. 查看日志确认插件工作状态

## 配置选项

- **启用插件**: 开关控制插件是否生效

## 日志示例

```
[INFO] 【硬链接劫持器】插件已启用，开始劫持硬链接方法
[INFO] 【硬链接劫持器】成功劫持LocalStorage.link方法
[WARNING] 【硬链接劫持器】成功劫持硬链接操作!
[INFO] 【硬链接劫持器】目标文件已存在，先删除: /target/path/file.mkv
[INFO] 【硬链接劫持器】创建硬链接: /source/path/file.mkv -> /target/path/file.mkv
[INFO] 【硬链接劫持器】硬链接成功!
```

## API 接口

插件提供以下 API 接口：

- `GET /status` - 获取插件运行状态

返回示例：
```json
{
    "enabled": true,
    "intercept_count": 15,
    "message": "硬链接劫持器插件运行正常"
}
```

## 远程控制命令

- `/hijacker_status` - 查看硬链接劫持器状态

## 适用场景

- Windows 系统通过 NFS 共享磁盘给 Linux 系统使用
- 原始硬链接操作导致的文件名乱码问题
- 需要自定义硬链接逻辑的场景

## 注意事项

1. **插件顺序**: 插件加载顺序为 1，确保优先加载
2. **权限要求**: 需要用户级别 1 以上权限
3. **安全性**: 插件会完全替换原始硬链接方法，请谨慎使用
4. **兼容性**: 仅适用于 LocalStorage 存储方式

## 故障排除

如果插件无法正常工作：

1. 检查日志是否有错误信息
2. 确认插件已正确启用
3. 验证文件路径和权限
4. 尝试重启 MoviePilot

## 版本信息

- **版本**: 1.0.0
- **作者**: HisingX
- **兼容性**: MoviePilot v2.x

## 开发说明

插件使用方法劫持技术，通过动态替换类方法来实现功能。如需修改硬链接逻辑，请关注 `_custom_link_logic` 方法。